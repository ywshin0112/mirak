<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.mirak.pay.chart.ChartMapper">
	<select id="getTotalByMenuList"
		resultType="kr.co.mirak.pay.chart.TotalByMenuVO">
		select pro_name, sum(totalPrice) as
		totalPrice from pay
		group by pro_name order by totalPrice desc limit 20;
	</select>

	<select id="getCountByGender"
		resultType="kr.co.mirak.pay.chart.RatioByVO">
		SELECT g.gender as mem_gender, COUNT(p.mem_gender) as count
		FROM (SELECT 1 as gender UNION SELECT 2 as gender) as g
		LEFT JOIN pay as p ON g.gender = p.mem_gender AND p.pro_name = #{clickedMenu}
		GROUP BY g.gender;
	</select>

	<select id="getCountByAge"
		resultType="kr.co.mirak.pay.chart.RatioByVO">
		SELECT CASE
        WHEN mem_age BETWEEN 0 AND 19 THEN '10'
        WHEN mem_age BETWEEN 20 AND 29 THEN '20'
        WHEN mem_age BETWEEN 30 AND 39 THEN '30'
        WHEN mem_age BETWEEN 40 AND 49 THEN '40'
        WHEN mem_age BETWEEN 50 AND 59 THEN '50'
        ELSE '60+' 
    	END as mem_age, SUM(count) as count
		FROM (SELECT COUNT(*) as count, FLOOR(p.mem_age/10)*10 as mem_age FROM pay as p
    	WHERE p.pro_name = #{clickedMenu}
    	GROUP BY mem_age) as t
    	GROUP BY mem_age
    	ORDER BY mem_age ASC;
	</select>

	<select id="getTotalByMonthList"
		resultType="kr.co.mirak.pay.chart.TotalByDayVO">
		SELECT DATE_FORMAT(pay_date, '%Y-%m') AS pay_date,
		SUM(totalPrice) AS totalPrice
		FROM pay
		GROUP BY DATE_FORMAT(pay_date,
		'%Y-%m')
		ORDER BY pay_date;
	</select>

	<select id="getTotalByDayList"
		resultType="kr.co.mirak.pay.chart.TotalByDayVO">
		SELECT DATE_FORMAT(pay_date, '%Y-%m-%d') AS pay_date,
		SUM(totalPrice) AS totalPrice
		FROM pay WHERE MONTH(pay_date) =
		#{clickedMonth}
		GROUP BY pay_date
		ORDER BY
		pay_date;
	</select>

	<select id="getTotalByEachMenu"
		resultType="kr.co.mirak.pay.chart.TotalByDayVO">
		select pay_date, totalPrice from pay where pro_name =
		#{clickedMenu} ORDER BY pay_date;
	</select>
</mapper>